<div id="add_note_form" class="container">
  <p class="text-center">
    <button type="button" class="btn btn-link"
      hx-get="/templates/main_content" hx-target="#content" hx-swap="innerHTML" hx-trigger="click">
      Назад
    </button>
  </p>

  <form id="note-form">
    <div class="mb-3">
        <label for="date" class="form-label">Дата</label>
        <input type="date" class="form-control" id="date" name="date" value="{{ date }}" required>
    </div>
    <div class="mb-3">
        <label for="consumable" class="form-label">Расходник</label>
        <select class="form-select" id="consumable" name="consumable" required>
            {% for consumable in consumables %}
                <option value="{{ consumable }}">{{ consumable }}</option>
            {% endfor %}
        </select>
    </div>
    <div class="mb-3">
        <label for="count" class="form-label">Количество</label>
        <input type="number" class="form-control" id="count" name="count" min="1" required>
        <div class="invalid-feedback" id="count-feedback">Необходимо заполнить данное поле.</div>
    </div>
    <button type="button" class="btn btn-primary btn-sm" id="submit-button">Добавить</button>
  </form>

  <p></p>

  <div id="response-area" style="transition: opacity 1s;"></div>
</div>

<script>
  document.getElementById('submit-button').addEventListener('click', function() {
    const date = document.getElementById('date').value;
    const consumable = document.getElementById('consumable').value;
    const count = document.getElementById('count').value;

    if (!count) {
      document.getElementById('count').classList.add('is-invalid');
      return;
    } else {
      document.getElementById('count').classList.remove('is-invalid');
    }

    const data = {
      date: date,
      consumable: consumable,
      count: parseInt(count, 10)
    };

    fetch('/notes', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json'
      },
      body: JSON.stringify(data)
    })
    .then(response => response.text())
    .then(data => {
      const responseArea = document.getElementById('response-area');
      responseArea.style.opacity = 1;
      responseArea.innerHTML = "Успешно добавлено".fontcolor('green');

      setTimeout(() => {
        responseArea.style.opacity = 0;
      }, 3000);
    })
    .catch(error => {
      console.error('Error:', error);
      document.getElementById('response-area').innerHTML = 'Произошла ошибка'.fontcolor("red");
    });
  });
</script>